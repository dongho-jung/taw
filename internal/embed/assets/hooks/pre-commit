#!/bin/sh
# PAW pre-commit hook: Safety net for .claude directory
#
# Note: PAW now creates .claude symlink in the agent directory (outside worktree),
# so this should rarely trigger. This hook serves as a safety net in case
# .claude ends up in the worktree due to manual user actions.

# Check if .claude is staged
if git diff --cached --name-only | grep -q "^\.claude$"; then
    # Automatically unstage .claude
    git reset HEAD -- .claude 2>/dev/null

    # Warn the user
    echo "PAW: Automatically unstaged .claude (worktree-local symlink)"
    echo "PAW: Re-running commit without .claude..."

    # Check if there are still staged changes
    if ! git diff --cached --quiet; then
        # There are still changes to commit, continue
        exit 0
    else
        # No changes left after removing .claude
        echo "PAW: No changes to commit after removing .claude"
        exit 1
    fi
fi

exit 0
