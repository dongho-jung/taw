# TAW (Tmux + Agent + Worktree)

A project management system built on Claude Code.

## Overview

- Start a tmux-based workspace from any directory with the `taw` command.
- Creating a task automatically launches the Claude Code agent.
- **Git mode**: Each task gets its own worktree when running in a git repo.
- **Non-Git mode**: Works without git; tasks run in the project directory.

## Usage

### Start taw in a project

```bash
cd /path/to/your/project  # git repo or regular directory
taw  # Creates .taw, starts tmux session, and automatically runs new-task
```

- In a git repo: Git mode (worktree created per task)
- In a regular directory: Non-Git mode (works directly in the project directory)

The first launch automatically opens the task editor.

### Create a task

To add another task inside the tmux session, press `‚å• n`:
- The editor opens so you can write the task content.
- Save and exit to automatically launch the agent.
- vi/vim/nvim start in insert mode automatically.

### Slash Commands

Slash commands available to the agent:

| Command | Description |
|---------|-------------|
| `/commit` | Smart commit (analyzes the diff and generates a message) |
| `/test` | Detects and runs project tests |
| `/pr` | Creates a PR and opens the browser |
| `/merge` | Merges the worktree branch into the current project branch |

**Task completion**:
- `auto-merge` mode: Automatically commit ‚Üí merge ‚Üí clean up ‚Üí close the window when the task ends (no ‚å•e needed)
- Other modes: Press `‚å• e` to commit ‚Üí PR/merge ‚Üí clean up according to ON_COMPLETE

<details>
<summary>Automatically reopen incomplete tasks</summary>

If a task is left unfinished and the window or tmux session closes, the next `taw` run automatically reopens those task windows.
</details>

<details>
<summary>Automatically clean up merged tasks</summary>

Tasks merged externally (PR merge, direct branch merge, etc.) are cleaned up automatically when `taw` runs.
</details>

### Window states

- ‚≠êÔ∏è New task input window
- ü§ñ Working
- üí¨ Waiting (user input required)
- ‚úÖ Done
- ‚ö†Ô∏è Warning (merge failed, needs manual resolution)

## Configuration

### Initial setup

When you first run `taw`, the setup wizard appears:

```
üöÄ TAW Setup Wizard
Work Mode:
  1. worktree (Recommended) - Each task gets its own git worktree
  2. main - All tasks work on current branch

Select [1-2, default: 1]:

On Complete Action:
  1. confirm (Recommended) - Ask before each action
  2. auto-commit - Automatically commit changes
  3. auto-merge - Auto commit + merge + cleanup      (worktree mode only)
  4. auto-pr - Auto commit + create pull request     (worktree mode only)

Select [1-2 or 1-4, default: 1]:

‚úÖ Configuration saved!
   Work mode: worktree
   On complete: confirm
```

Settings are saved to `.taw/config`.

### Rerun setup

```bash
taw setup  # Rerun the setup wizard
```

<details>
<summary>Example config (.taw/config)</summary>

```
# TAW Configuration
# Generated by taw setup

# Work mode: worktree or main
# - worktree: Each task gets its own git worktree (recommended)
# - main: All tasks work on the current branch
work_mode: worktree

# On complete action: confirm, auto-commit, auto-merge, or auto-pr
# - confirm: Ask before each action (recommended)
# - auto-commit: Automatically commit changes
# - auto-merge: Auto commit + merge + cleanup + close window
# - auto-pr: Auto commit + create pull request
on_complete: confirm

# Hook to run after worktree creation (optional)
# Single line example: worktree_hook: npm install
# Multi-line example:
#   worktree_hook: |
#     npm install
#     npm run build

```
</details>

### Configuration options

| Setting | Option | Description |
|---------|--------|-------------|
| `work_mode` | `worktree` | Create a git worktree per task (isolated, recommended) |
|             | `main` | Work directly on the current branch (simple) |
| `on_complete` | `confirm` | Ask before each action (safe) |
|               | `auto-commit` | Auto commit (merge/PR are manual) |
|               | `auto-merge` | **Auto** commit + merge + clean up + close window (worktree mode only) |
|               | `auto-pr` | Auto commit + create PR (worktree mode only) |
| `worktree_hook` | (command) | Shell command(s) to run after worktree creation (e.g., `npm install`) |

<details>
<summary>Other configuration</summary>

- System prompt: Embedded in binary (copied to `.taw/.claude/` on setup)
- `.taw/PROMPT.md`: Project-specific prompt (per project)
- `.taw/memory`: Project memory (YAML, update in place for reusable info)
- Slash commands: Embedded in binary (copied to `.taw/.claude/commands/` on setup)
- `EDITOR` environment variable: Editor for writing tasks (default: vim)
</details>

## Dependencies

```bash
brew install tmux gh
```

## tmux shortcuts

| Action | Shortcut |
|--------|----------|
| Cycle panes | `‚å• Tab` |
| Move window | `‚å• ‚Üê/‚Üí` |
| Toggle new window | `‚å• n` (task ‚Üî new window) |
| Complete task | `‚å• e` (log progress in user pane, commit ‚Üí PR/merge ‚Üí cleanup) |
| Merge all done tasks | `‚å• m` (merge + end all ‚úÖ tasks) |
| Toggle shell pane | `‚å• p` (bottom 40%, open/close shell in current worktree) |
| Live log viewer | `‚å• l` (toggle log viewer, vim-like navigation) |
| Add quick task to queue | `‚å• u` (auto-run after current task completes) |
| Help | `‚å• /` |
| Leave session | `‚å• q` (detach) |

> **Note**: All shortcuts work regardless of the keyboard input language (English/Korean).

## Quick task queue

Quickly capture ideas or follow-up work while you are busy.

1. Press `‚å• u` to open the popup.
2. Enter the task description and hit Enter.
3. When the current task finishes (`‚å• e`), queued tasks start automatically.

Queue layout:
```bash
.taw/.queue/      # Queue directory
‚îî‚îÄ‚îÄ 001.task      # Pending task file
```

## Log viewer

Press `‚å• l` to open the live log viewer.

<details>
<summary>Controls</summary>

| Key | Description |
|----|-------------|
| `‚Üë` / `‚Üì` | Scroll vertically |
| `‚Üê` / `‚Üí` | Scroll horizontally (when word wrap is off) |
| `g` | Jump to top |
| `G` | Jump to bottom |
| `PgUp` / `PgDn` | Page scroll |
| `s` | Toggle tail mode (follow new logs) |
| `w` | Toggle word wrap |
| `l` | Cycle log level filter (L0+ ‚Üí L1+ ‚Üí ... ‚Üí L5 only) |
| `q` / `Esc` / `‚å• l` | Close the log viewer |
</details>

## Task history

When a task ends, the full content of the agent pane is automatically captured and saved.

### Storage location

```
.taw/history/
‚îî‚îÄ‚îÄ YYMMDD_HHMMSS_task-name  # e.g., 241228_134501_my-feature
```

### Usage examples

- Review what the agent did in a past task.
- Trace how a problem was solved.
- Use as reference material for learning and improvement.
